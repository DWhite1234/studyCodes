# 消息发送流程

1.producer将单独的一条消息封装成producerRecord对象,然后通过拦截器,序列化,分区器 单独发往recordaccumulator(共享变量)
2.在共享变量中,把这些已经分区好的消息组成一个recordBatch(一批数据)(达到批大小batch.size,或时间linger.time)
3.sender线程不断从共享变量中把分区号的一批数据发往topic对应的分区
4.如果此时ack返回失败,producer重新发送该批次的消息至共享变量(重复共享变量的流程)
    如果ack是在leader 落盘,follow同步的时候,leader挂了导致的ack不返回,同时数据没有同步完成,在ISR中重新选了新的leader,producer重新发送这一批次的消息,同步的时候从HW的位置开始同步,但是也导致了数据的重复

    数据重复配合了后面的幂等性和生产者的事务 来解决了